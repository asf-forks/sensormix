<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:osgi="http://www.springframework.org/schema/osgi"
	xmlns:jaxws="http://cxf.apache.org/jaxws" xmlns:cxf="http://camel.apache.org/schema/cxf"
	xmlns:util="http://www.springframework.org/schema/util" xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="
       http://cxf.apache.org/jaxws 
       http://cxf.apache.org/schemas/jaxws.xsd
       http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
       http://www.springframework.org/schema/osgi  
       http://www.springframework.org/schema/osgi/spring-osgi.xsd
       http://camel.apache.org/schema/spring 
       http://camel.apache.org/schema/spring/camel-spring.xsd
       http://camel.apache.org/schema/cxf
	   http://camel.apache.org/schema/cxf/camel-cxf.xsd
	   http://www.springframework.org/schema/util 
	   http://www.springframework.org/schema/util/spring-util-2.5.xsd
	   http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context-2.5.xsd">

	<!-- Output, to jaxws or osgi -->
	<!-- <jaxws:client id="aoccEsb" -->
	<!-- serviceClass="eu.protectrail.ns.service.unified.UnifiedService" -->
	<!-- address="http://localhost:8099/test" /> -->
	<!-- address="http://172.17.0.81:9181/cxf/unifiedServiceEndpoint" /> -->

	<osgi:reference id="aoccEsb"
		interface="eu.protectrail.ns.service.unified.UnifiedService"
		bean-name="unifiedServiceEntryProxy" timeout="300000" cardinality="1..1" />


	<bean id="soccLogicIntegration"
		class="com.thalesgroup.it.aocc.prail.integration.SoccLogicIntegration">
		<property name="capAdapter" ref="capAdapterProxy" />
	</bean>

	<!-- Endpoints on SOCC -->
	<!-- use in SMX address="/thalesPrailEventsEntry" which means http://0.0.0.0:9181/cxf/thalesPrailEventsEntry -->
	<cxf:cxfEndpoint id="cxfPrailEntry" address="/thalesPrailEventsEntry"
		wsdlURL="wsdl/event-broker.wsdl">
		<cxf:properties>
			<entry key="dataFormat" value="PAYLOAD" />
			<entry key="serviceName" value="{http://protectrail.eu/wsn/events}EventProducer" />
			<entry key="portName"
				value="{http://protectrail.eu/wsn/events}EventProducerPort" />
		</cxf:properties>
	</cxf:cxfEndpoint>

	<!-- Endpoints on Event Broker -->
	<!-- Subscription -->
	<cxf:cxfEndpoint id="cxfEventBrokerSubscription"
		address="http://172.17.0.201:9090/EventConsumer" wsdlURL="wsdl/event-broker.wsdl">
		<cxf:properties>
			<entry key="dataFormat" value="PAYLOAD" />
			<entry key="serviceName" value="{http://protectrail.eu/wsn/events}EventConsumer" />
			<entry key="portName"
				value="{http://protectrail.eu/wsn/events}EventConsumerPort" />
		</cxf:properties>
	</cxf:cxfEndpoint>

	<!-- Notification -->
	<cxf:cxfEndpoint id="cxfEventBrokerNotification"
		address="http://172.17.0.201:9090/EventProducer" wsdlURL="wsdl/event-broker.wsdl">
		<cxf:properties>
			<entry key="dataFormat" value="PAYLOAD" />
			<entry key="serviceName" value="{http://protectrail.eu/wsn/events}EventProducer" />
			<entry key="portName"
				value="{http://protectrail.eu/wsn/events}EventProducerPort" />
		</cxf:properties>
	</cxf:cxfEndpoint>

	<!-- Routes -->
	<camelContext id="prailEventBrokerIntCamelContext" xmlns="http://camel.apache.org/schema/spring">
		<proxy id="capAdapterProxy" serviceInterface="com.thalesgroup.it.aocc.prail.integration.CapAdapter"
			serviceUrl="direct:prailCapAdapter" />

		<!-- refer to a given route to be used -->
		<routeContextRef ref="prailEntryRoutes" />
		<routeContextRef ref="prailOutRoutes" />
		<routeContextRef ref="prailSubscriptionRoutes" />

		<routeContextRef ref="soccEntryRoutes" />
		<routeContextRef ref="soccOutRoutes" />

		<routeContextRef ref="forwardToSoccLogicIntegrationRoutes" />

		<route id="prailMsgDumpRoute">
			<from uri="direct:prailMsgDump" />
			<to
				uri="file:///usr/local/prail_msg_dump?fileName=msg-${headers.prailFriendlyTopic}-${date:now:yyyyMMdd_HHmmss_SSS}.xml" />
		</route>
		
	</camelContext>
</beans>
